# 10장: 테스트 코드 품질 - 추출된 정보

## 핵심 내용
- 테스트 코드도 생산 코드와 동일한 품질 기준(가독성, 유지보수성, 성능)을 갖춰야 지속 가능한 안전망이 된다.
- 좋은 테스트는 빠르고(a.k.a. Fast), 독립적이며, 강력한(assertive) 검증을 수행한다.
- 테스트 냄새(중복, 허술한 단언, 플래키 테스트 등)는 빠르게 감지하고 리팩터링해야 한다.
- 테스트 구조(Arrange-Act-Assert), 헬퍼/DSL, 의도 중심 네이밍으로 가독성을 높인다.
- 테스트 코드 품질 지표와 경험적 연구를 활용해 개선 우선순위를 정한다.

## 상세 핵심 내용

### 유지보수성 원칙
- **Fast**: 느린 테스트는 실행 빈도를 떨어뜨리므로 외부 의존성 제거, 계층 분리, 느린 테스트 묶음 관리.
- **Isolated**: 테스트 간 상태 공유 금지, 픽스처는 각 테스트가 직접 구성하고 정리(clean up)한다.
- **Readable**: Arrange-Act-Assert 패턴, Given/When/Then 표현, 도메인 용어 사용으로 의도를 드러낸다.
- **Deterministic**: 시간/랜덤/스레드 등 비결정 요소 제어, 플래키 테스트는 즉시 수정.
- **Assertive**: 필요한 모든 결과를 강하게 검증하고, 실패 시 명확한 메시지를 제공.

### 좋은 테스트 코드 작성 기법
- 테스트 빌더/데이터 팩토리로 복잡한 픽스처 생성을 단순화.
- 중복된 arrange/tear-down 로직은 헬퍼/파라미터화로 추상화하되 과도한 마법을 피한다.
- 커스텀 어설션, 매처, DSL을 도입해 도메인 의미를 강조.
- 테스트 카탈로그(디렉터리 구조, 명명 규칙) 정립으로 검색성과 일관성 확보.

### 테스트 냄새와 대응
- **Eager Test**: 여러 기능을 동시에 검증 → 작은 테스트로 분리.
- **Mystery Guest**: 숨은 외부 의존성 → 인터페이스 노출 및 픽스처 명시화.
- **Resource Optimism**: 파일/네트워크/DB 가정 → 실패 시 리트라이/검증, 리소스 존재 확인.
- **Assertion Roulette**: 다수 단언 실패 시 원인 불명확 → 설명 메시지, 커스텀 어설션 활용.
- **Conditional Test Logic**: 테스트 내부 조건문 제거, 데이터 주도 테스트 활용.
- **Flaky Test**: 실행 순서/환경 의존 → 제어 불가능 요소 추상화, 재시도보다 원인 제거 우선.

### 품질 측정과 연구 인사이트
- 커버리지 외에 mutation testing, flaky rate, 실패 패턴 분석 등 보조 지표 활용.
- 연구(예: Garousi & Küçük 2018, Lam et al. 2019)에서 흔한 문제: 플래키, 허약 단언, 테스트 코드 부패.
- 자동화 도구(iDFlakies 등) 소개하나, 아직 완벽하지 않으므로 개발자가 지속적으로 점검해야 함.

### 테스트 코드 리팩터링
- 정기적으로 테스트 리뷰/리팩터링 스프린트 수행.
- 복잡한 테스트는 단계적 단순화(픽스처 분해, 헬퍼 함수 도입, 명확한 네이밍)로 개선.
- 테스트를 통해 설계 결함(관찰성 부족, 강결합)을 발견하면 생산 코드도 함께 개선.

## 주요 화제

### 1. 테스트 품질 원칙
- 빠름, 독립성, 가독성, 결정성, 강력한 단언.

### 2. 테스트 코드 제작 기법
- 빌더, 헬퍼, DSL, 커스텀 어설션.

### 3. 테스트 냄새와 해결책
- Eager, Mystery Guest, Flaky 등 대표 냄새와 대응 전략.

### 4. 품질 측정 및 개선 프로세스
- 지표, 연구 인사이트, 리팩터링 루틴.

## 부차 화제

### 1. 테스트 조직 문화
- 코드 리뷰에서 테스트 품질 확인, 테스트 실패 대응 정책.

### 2. 도구
- 커버리지, mutation, flaky 탐지 도구 소개 및 활용 시 주의점.

### 3. 문서화와 가이드라인
- 팀 내 테스트 스타일 가이드, 명명 규칙, 템플릿.

### 4. 테스트와 설계의 상호 보완
- 테스트 품질 문제를 통해 설계 개선 포인트를 찾는 사례.

### 5. 테스트 데이터 전략
- 독립적 데이터 세트 관리, 공유 픽스처의 장단점, 정리(cleanup) 루틴.
