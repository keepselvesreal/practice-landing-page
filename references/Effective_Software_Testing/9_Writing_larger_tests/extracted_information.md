# 9장: 더 큰 테스트 작성 - 추출된 정보

## 핵심 내용
- 단위 테스트로 충분하지 않은 영역은 통합 테스트·시스템 테스트로 보강해야 한다.
- 여러 클래스가 협력해 완성되는 비즈니스 흐름은 조합 테스트로 검증해 결함을 줄인다.
- DB/외부 서비스와의 상호작용은 인메모리 대체, 트랜잭션 롤백, 테스트 픽스처로 안정화한다.
- 엔드투엔드 테스트는 핵심 경로 위주로 구성하고, 느린 테스트의 신뢰성과 유지비를 관리한다.
- 테스트 환경 표준화(구성, 데이터, 격리)를 통해 플래키 테스트를 방지한다.

## 상세 핵심 내용

### 언제 큰 테스트가 필요한가
- 다수의 규칙/컴포넌트가 조합돼 결과를 산출할 때(예: 쇼핑카트 가격 계산) 최종 산출 값을 검증.
- 플러그인/아키텍처 컴포넌트처럼 외부 프레임워크가 호출해주는 코드는 실제 호출 환경에서 검증 필요.

### 컴포넌트 통합 테스트 패턴
- 개별 규칙을 단위 테스트로 검증한 뒤, `PriceRulesEngine`처럼 여러 규칙을 묶어 전체 합산을 테스트.
- 현실 시나리오 입력을 준비하고, 결과·부수효과(로깅, 이벤트 등)를 동시에 확인.

### 데이터베이스 통합 테스트
- 인메모리 DB(HSQLDB 등) 사용, 트랜잭션 롤백, 테스트 전후 데이터 클린업으로 독립성 확보.
- SQL/ORM 쿼리 정확성을 검증하면서도 외부 시스템 의존을 최소화.
- 마이그레이션 스크립트 적용, 픽스처 삽입, 스키마 동기화 등 유지 전략을 제시.

### 시스템 테스트(엔드투엔드) 전략
- REST API, 메시지 흐름 등을 실제 포맷으로 호출해 계약/구성 오류를 잡는다.
- 느림·취약성을 최소화하기 위해 핵심 사용자 여정, 회귀 위험이 큰 시나리오에 집중.
- 환경 구성(컨테이너, docker-compose), 공용 픽스처, 독립 실행 가능한 스크립트를 마련.

### 플래키 테스트 예방
- 비결정적 요소(시간, 난수, 외부 의존) 제어, 동시성·타이밍 이슈 대비 리트라이/조건 대기 패턴.
- 테스트 데이터를 격리하고, 테스트 실행 순서 의존성을 제거.

## 상세 내용

### 테스트 계층 협력
- 단위 테스트: 빠르고 많음, 상세 규칙 검증.
- 통합 테스트: 협력 동작, 인프라 계층 검증.
- 시스템 테스트: 사용자 관점 행동 확인. 각 층의 역할과 비중을 조정해 피라미드 균형 유지.

### 환경 관리
- CI에서 통합/시스템 테스트를 실행하기 위한 스크립트화, 컨테이너 이미지 관리, 구성 분리.
- 테스트 격리 전략: 임시 DB 스키마, 네임스페이스, 파일 시스템 샌드박스, 모의 서비스.

### 보고와 디버깅
- 실패 시 원인 파악을 돕도록 로깅, 스냅샷, 예외 메시지 강화.
- 테스트 이름과 설명을 통해 시나리오 의도를 명확히 표현.

## 주요 화제

### 1. 통합 테스트 대상 식별
- 협력 클래스, 플러그인/어댑터 등.

### 2. DB/외부 의존성과의 통합
- 인메모리 대체, 데이터 시딩, 롤백 전략.

### 3. 시스템 테스트 구축
- 엔드투엔드 흐름, 환경 세팅, 핵심 시나리오.

### 4. 안정성 확보
- 플래키 테스트 방지, 자원 격리, 관찰성 강화.

## 부차 화제

### 1. 테스트 피라미드 재해석
- 단위/통합/시스템 테스트 비율 조정, 조직별 적용 예.

### 2. 계약 테스트와의 연계
- 마이크로서비스 간 인터페이스 검증을 위한 소비자/프로바이더 테스트.

### 3. 성능·부하 테스트 예비 단계
- 엔드투엔드 테스트 인프라를 성능 테스트로 확장하는 방법.

### 4. 데이터 관리 도구
- DBUnit, Flyway, Liquibase 등 마이그레이션·시드 도구 활용.

### 5. CI 파이프라인 설계
- 테스트 단계 분리, 실패 시 롤백, 재현 가능한 실행 환경 구성.
