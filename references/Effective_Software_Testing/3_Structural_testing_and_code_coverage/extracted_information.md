# 3장: 구조 기반 테스트와 코드 커버리지 - 추출된 정보

## 핵심 내용
- 명세 기반 테스트 이후 소스 코드를 참고해 누락된 케이스를 보강하는 구조 기반 테스트가 필요하다.
- 커버리지 도구는 테스트가 닿지 않은 분기·조건·루프를 식별해 추가 테스트 설계를 돕는다.
- 라인/분기/조건+분기/경로/MC/DC 등 커버리지 기준은 강도와 비용이 다르므로 상황에 맞게 선택해야 한다.
- 루프, 경계 조건, 구현 세부 로직 등 명세에 드러나지 않은 요소는 구조 분석으로 발견한다.
- 커버리지 수치는 단독 목표가 아니라 테스트 효과성을 높이기 위한 피드백 지표로 활용해야 한다.

## 상세 핵심 내용

### 구조 기반 테스트 절차
- 명세 기반 테스트 후 코드 리딩 → 커버리지 실행 → 미커버 영역 분석 → 테스트 추가 여부 결정 → 반복.
- JaCoCo 등 도구 리포트로 조건별 분기 수, 미커버 라인, 클래스 초기화 누락 등을 확인한다.
- 누락 이유가 명세 실수인지, 구현상 최적화인지 파악해 테스트 추가·요구 정정·코드 삭제 등 대응한다.

### 커버리지 기준 이해
- `라인`은 가장 약한 기준으로 해당 라인을 한 번이라도 실행하면 충족.
- `분기`는 각 조건문이 true/false를 모두 거치도록 최소 두 테스트가 필요.
- `조건+분기`는 각 조건을 true/false로 평가하고 전체 분기의 true/false도 충족해야 함.
- `경로`는 가능한 실행 경로 전체를 커버하지만 현실적으로 비용이 매우 큼.
- `MC/DC`는 각 조건이 독립적으로 결정에 영향을 미치는 경우를 증명하는 `N+1` 테스트로 실용성과 강도를 균형 잡는다.

### 루프·경계 다루기
- 루프에 대해 0회·1회·다수 회 실행을 보장하는 `loop boundary` 기준을 적용한다.
- on/off point 분석으로 `<=`, `<`, `==` 등의 임계값 양측을 시험해 경계 결함을 찾는다.

### 실전 예제: `leftPad`
- 명세 기반으로 null/빈 값/사이즈 비교/패딩 문자열 조합 등 9개 테스트 도출.
- 커버리지 리포트에서 패딩 길이 비교 분기가 미커버임을 확인하고 3개 추가 테스트(T10~T12)로 보강.
- 객체 동일성 확인, 경계 조건 등 구현 특화 테스트를 추가해 행동을 고정.

### 구조 테스트만의 한계
- `countClumps` 사례: 분기 100%만 충족하면 요구사항 위반을 놓칠 수 있음.
- 명세 기반 없이 커버리지만 채우면 잘못된 가정으로도 100%를 달성할 수 있으므로 두 접근을 결합해야 한다.

### 커버리지 수치 활용 가이드
- 높은 커버리지는 결함 탐지력과 상관성이 있으나, 100%라도 충분 조건이 되지는 않는다.
- 10%처럼 낮은 값은 명백히 테스트 부족을 의미하며, 목표값은 맹목적 숫자보다 리포트 분석이 중요하다.
- 조직 경험·연구 결과(예: Hutchins94, Inozemtseva14, Gopinath20 등)를 참고해 목표 구간과 해석을 정한다.

## 상세 내용

### 커버리지 도구 활용 팁
- 분기 옆 다이아몬드, 세부 조건, 클래스 선언 미커버 등 리포트 신호를 해석하는 방법을 소개.
- 도구마다 공식이 다르므로 사용 환경에 맞춰 문서를 확인해야 하며, 숫자 자체보다 맥락 해석이 중요.

### MC/DC 적용 절차
- 진리표 작성 → 조건별 독립성 쌍 구성 → 최소 N+1 테스트 선택 → 잉여 조합 제거 과정을 설명.
- `if (!isLetter && (last=='s' || last=='r'))` 예제로 {T2,T3,T4,T6} 조합을 선정하는 방법을 보여준다.

### 루프와 반복 구조 보강
- while/for의 break, continue, 비정형 조건을 분석해 테스트 케이스에서 반복 횟수를 제어한다.
- 반복 실행 시 데이터 준비 비용, 성능 고려 사항도 체크한다.

### 경계 식별과 테스트 설계
- 코드에서 직접 조건을 읽어 on/off 값을 파생하고, 명세에서 놓친 경계를 식별한다.
- 패딩 길이, 문자열 길이, 사이즈 차이 등 수치 경계를 기반으로 테스트를 확장했다.

### 커버리지 논쟁과 안티패턴
- 커버리지를 KPI로 강제할 때 생기는 “무의미한 테스트” 생성, assert 없이 실행만 하는 테스트 등 문제를 경고.
- 커버리지 하락 시 원인 추적(테스트 삭제, 코드 복잡도 증가 등)과 정성적 리뷰 필요성을 강조.

## 주요 화제

### 1. 구조 기반 테스트 절차화
- 명세 기반 이후 코드 기반 확대 방법, 반복적 적용 흐름, 도구 활용 포인트.

### 2. 커버리지 기준 비교
- 라인/분기/조건+분기/경로/MC/DC/루프 경계의 정의와 적용 비용.

### 3. 실전 사례 분석
- `CountWords`, `leftPad`, `countClumps` 등 실제 코드에 구조 기반 테스트를 적용하는 과정을 단계별로 소개.

### 4. 커버리지 수치 해석
- 연구 결과, 구글 가이드라인 등을 토대로 숫자 해석과 조직 전략 수립 시 고려 사항 제시.

## 부차 화제

### 1. 도구 선택과 설정
- JaCoCo 등 JVM 도구 언급, IDE 통합, 리포트 해석법.

### 2. 테스트 유지보수
- 커버리지 확보를 위한 테스트가 가독성과 유지보수성을 해치지 않도록 리팩터링 필요성.

### 3. 팀 커뮤니케이션
- 미커버 영역 공유, 커버리지 리포트 리뷰 미팅, 요구사항/설계자와의 피드백 루프.

### 4. 품질 지표 조합
- 커버리지 외에 mutation score, defect density 등과 함께 보는 다면적 품질 측정 제안.

### 5. 교육 및 참고 자료
- MC/DC 추가 자료(영상), 구글 커버리지 베스트 프랙티스 등 학습 리소스 안내.
