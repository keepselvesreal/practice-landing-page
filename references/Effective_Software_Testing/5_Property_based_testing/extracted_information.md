# 5장: 속성 기반 테스트 - 추출된 정보

## 핵심 내용
- 속성 기반 테스트는 구체 사례 대신 “항상 지켜져야 할 성질”을 정의하고 프레임워크가 다양한 입력을 탐색하도록 한다.
- jqwik 같은 프레임워크는 제너레이터, 프로바이더, 시퀀스 조합을 통해 경계값을 포함한 무작위 데이터를 자동으로 공급한다.
- 속성 기반 접근은 예제 기반 테스트를 보완하며, 복잡한 조합·시퀀스·도메인 객체를 효율적으로 검증할 수 있다.
- 균형 잡힌 입력 분포와 현실적인 제약 표현이 실패 재현과 버그 발견력을 좌우한다.
- 적용 여부는 복잡도·불확실성·조합 폭발 여부를 기준으로 판단하고, 필요 시 예제 기반과 혼용한다.

## 상세 핵심 내용

### 개념과 기본 예제
- 합격/불합격 판정 프로그램을 속성 세 가지(합격 구간, 불합격 구간, 예외 구간)로 모델링하여 jqwik 테스트 작성.
- `@Property`, `@ForAll`, `@Provide` 사용법과 기본 제너레이터(`FloatRange`, `Arbitraries.oneOf`) 구성을 소개.
- 프레임워크는 기본 1,000회 실행하며, 실패 시 최소 예제로 축소(shrink)하고 재현용 seed를 출력한다.

### 실전 사례 전개
- `unique(int[])`: 100개 정수 리스트에서 유일 값 추출 속성을 선언하고, 중복 제거·내림차순 정렬 여부를 검증.
- `indexOf(...)`: 무작위 배열·검색 값·시작 인덱스를 생성해 여러 경계 조합을 자동으로 탐색하고 기대 인덱스 계산.
- `Basket` 클래스: 명령(Action) 시퀀스를 임의로 조합해 add/remove 호출 흐름을 검증, 계약(불변식) 위반이 없는지 확인.
- 복잡 객체(`Book`) 생성을 위해 Combinators API로 필드별 제너레이터를 조합하는 방법 제시.

### 속성 설계 전략
- 명세 기반 테스트에서 파생한 분할·경계·관계식을 속성으로 승화해 테스트 아이디어를 잃지 않는다.
- 무분별한 제약은 데이터 생성 실패를 초래하므로 생성 가능성과 성능을 고려해 조건을 설계한다.
- 경계값 표현을 명확히 해 프레임워크가 edge case를 자동 시도하도록 한다.
- 입력 분포가 특정 분할에 치우치지 않도록 별도 속성으로 분리하거나 통계를 활용해 분포를 관찰한다.

### 프레임워크 활용 포인트
- `Arbitraries`, `Combinators`, `ActionSequence` 등 jqwik 기능으로 도메인에 맞는 제너레이터를 작성.
- seed 로그를 이용해 실패 재현, 통계 API로 생성 데이터 분포 확인, sequences로 상태 전이 시나리오 구성.

### 도입 의사결정과 한계
- 예제 기반 테스트는 단순성과 가독성이 장점; 속성 기반 테스트는 의심이 남거나 조합 폭발이 우려될 때 적용.
- 작성 난이도가 높고 창의력이 요구되므로 팀 학습 곡선을 고려해야 한다.
- 모든 버그를 잡지는 못하며, 속성 설계가 부실하면 의미 없는 무작위 실행이 된다.

## 상세 내용

### 문제 해결 과정
- 속성 도출 → 입력 데이터 제약 정의 → 실행 후 실패 케이스 분석 → 필요한 경우 추가 속성/제약 보정 순환을 강조.
- AddAction/RemoveAction 생성처럼, 도메인 지식을 활용해 합리적 범위와 관계 제약을 명시한다.

### 실패 진단과 shrink
- jqwik은 실패 시 자동으로 간소화된 입력을 찾아주며, 이 과정 덕분에 원인 분석이 쉬워진다.
- seed 공유로 CI·동료 환경에서 동일 실패를 재현 가능.

### 현업 고려 사항
- 속성 테스트는 실행 시간이 길 수 있어 CI 제한 시간, 난수 기반 비결정성, 디버깅 로그 전략 등을 설계해야 한다.
- 복잡한 제너레이터는 재사용 가능한 헬퍼/팩토리 클래스로 추출해 테스트 코드 품질을 유지.

### 빈번한 실수와 해결책
- 생성 불가능한 제약 → 조건 완화 또는 커스텀 생성 로직 도입.
- 경계 누락 → `lessThan`, `greaterThan` 등 명확한 표현 사용.
- 분포 왜곡 → 속성 분리, 조건부 로직 제거, Statistics API로 분포 확인.

## 주요 화제

### 1. 속성 기반 테스트 기초
- 개념, jqwik DSL, property 구성 요소.

### 2. 다층 예제 분석
- PassingGrade, unique, indexOf, Basket, Book 생성 등 다양한 난도의 예시.

### 3. 데이터 생성 기술
- 제너레이터, Combinators, ActionSequence, custom provider 활용.

### 4. 실무 적용 가이드
- 언제 선택할지, 예제 기반과의 병행 전략, 성능/재현성 관리.

## 부차 화제

### 1. 프레임워크 생태계
- 언어별 속성 테스트 도구 존재, jqwik 중심 설명이지만 사고법은 공통임을 명시.

### 2. 경계·분포 통계 도구
- jqwik Statistics 기능으로 입력 분포를 계측한 사례 소개.

### 3. 계약 기반 테스트 연계
- Basket 예제에서 계약(assertions)과 속성 테스트가 상호 보강됨을 강조.

### 4. 창의성·학습 곡선
- 속성 발굴과 제너레이터 설계에 요구되는 사고 과정과 팀 교육 필요성을 언급.

### 5. 테스트 실패 대응
- seed 기록, shrink 결과 해석, 재현 가능한 버그 리포트 작성 관행.
