# 9장: Tox를 사용한 테스트 환경 관리 - 추출된 정보

## 핵심 내용
- Tox를 사용한 Python 가상 환경 관리
- 다중 Python 버전에서의 테스트 실행
- Travis CI와 Tox의 통합
- 환경별 테스트 설정 관리

## 상세 핵심 내용

### Tox 소개
- **Tox**: Python 가상 환경 관리자로 다중 Python 버전에서 프로젝트 테스트
- **목적**: 테스트 환경 설정 자동화와 의존성 관리
- **장점**: 로컬과 CI 파이프라인에서 동일한 명령어 사용 가능
- **설치**: `pip install tox`

### tox.ini 설정 파일
- **[tox] 섹션**: Tox 자체 설정, setupdir로 프로젝트 위치 지정
- **[testenv] 섹션**: 테스트 환경 설정, deps와 commands 옵션
- **deps**: 테스트에 필요한 의존성 패키지 목록
- **commands**: 테스트 실행 명령어 정의

### 다중 Python 버전 테스트
- **envlist**: 테스트할 Python 버전 목록 지정 (예: py27, py37, py38)
- **환경별 설정**: [testenv:envname] 형식으로 특정 환경 커스터마이징
- **호환성 이슈**: 구 버전 Python에서의 PyTest 호환성 문제 해결

### 유연성과 확장성
- **{posargs}**: 명령행에서 추가 옵션을 테스트 명령어로 전달
- **환경 분리**: 벤치마크용 별도 환경 설정으로 기본 테스트와 분리
- **온디맨드 실행**: -e 옵션으로 특정 환경만 실행

## 상세 내용

### 기본 tox.ini 설정
```ini
[tox]
setupdir = ./src

[testenv]
deps =
    pytest == 6.0.2
    pytest-bdd == 3.4.0
    flaky == 3.7.0
    pytest-benchmark == 3.2.3
    pytest-cov == 2.10.1
commands =
    pytest --cov=contacts {posargs}
```

### Python 2.7 호환성 설정
```ini
[testenv:py27]
deps =
    pytest == 4.6.11
    pytest-bdd == 3.4.0
    flaky == 3.7.0
    pytest-benchmark == 3.2.3
    pytest-cov == 2.10.1
```

### 벤치마크 전용 환경
```ini
[testenv:benchmarks]
commands =
    pytest --no-cov ./benchmarks {posargs}
```

### Travis CI 통합
```yaml
language: python
python:
  - 3.7
  - 3.8
  - 3.9
install:
  - "pip install tox-travis"
script:
  - "tox"
```

## 주요 화제

### 1. 테스트 환경 표준화
- 개발자 간 일관된 테스트 환경 보장
- 의존성 버전 고정을 통한 재현 가능한 테스트
- 로컬과 CI 환경에서의 동일한 실행 방식
- 프로젝트 기여자들의 진입 장벽 낮춤

### 2. 다중 버전 호환성 테스트
- Python 버전 업그레이드 시 단계적 롤아웃 지원
- 구 버전과 신 버전 동시 지원을 위한 테스트
- 버전별 의존성 차이 해결 방안
- 호환성 문제 조기 발견과 해결

### 3. CI/CD 파이프라인 통합
- Travis CI와의 원활한 연동
- tox-travis 플러그인을 통한 중복 설정 방지
- 환경 충돌 해결과 효율적인 리소스 사용
- 자동화된 테스트 실행과 보고

### 4. 환경별 테스트 전략
- 기본 테스트와 벤치마크 테스트 분리
- 문서 빌드용 별도 환경 구성
- 커버리지 보고와 성능 측정의 분리
- 환경별 특화된 설정과 명령어

## 부차 화제

### 1. 의존성 관리 전략
- **정확한 버전 지정**: 의존성 패키지의 정확한 버전 명시로 재현성 보장
- **환경별 차이점**: Python 버전에 따른 패키지 호환성 차이 관리
- **자동 설치**: 프로젝트 자체는 Tox가 자동으로 설치하므로 deps에 포함 불필요

### 2. 명령어 유연성
- **posargs 활용**: `tox -- ./tests -k load` 형태로 추가 옵션 전달
- **필터링**: 특정 테스트만 실행하기 위한 PyTest 옵션 전달
- **디렉토리 지정**: 특정 디렉토리의 테스트만 실행

### 3. 개발자 모드 설정
- **usedevelop = true**: 소스 디렉토리를 직접 설치하여 편집 가능한 모드
- **커버리지 정확성**: 설치된 패키지가 아닌 소스 코드에 대한 커버리지 측정
- **개발 효율성**: 소스 변경 시 재설치 없이 즉시 반영

### 4. 환경 분리와 조직화
- **envlist 관리**: 기본 실행 환경과 선택적 실행 환경 구분
- **상속 구조**: 기본 [testenv] 설정을 특화 환경이 상속
- **명명 규칙**: py27, py37 등 표준 명명 규칙과 커스텀 환경명

### 5. 트러블슈팅과 디버깅
- **InterpreterNotFound 오류**: Python 인터프리터 경로 문제 해결
- **의존성 충돌**: 패키지 버전 호환성 문제 진단과 해결
- **F-string 문법**: Python 2.7에서 지원하지 않는 최신 문법 이슈

### 6. 성능과 리소스 최적화
- **환경 재사용**: .tox 디렉토리를 통한 환경 캐싱
- **병렬 처리**: 다중 환경에서의 테스트 병렬 실행
- **선택적 실행**: 변경된 환경만 재빌드하여 시간 절약