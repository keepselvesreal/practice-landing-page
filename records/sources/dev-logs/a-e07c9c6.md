```
session-id: a5cfc538-d607-4a4c-866a-9c68eeac4678

```

# ë‚˜
- í‘¸ì‹œë¥¼ ì•ˆ í•´ì„œ ciê°€ ë™ì‘í•˜ì§€ ì•Šê³  ìˆì—ˆë˜ ê²ƒ ^^;
- chroniumì€ ë³„ë„ ì„¤ì¹˜í•´ì„œ ë‹¨ê³„ ì¶”ê°€í•œ ë“¯?
     -          uv pip install --system -r pyproject.toml
       30 -          uv pip install --system pytest pytest-cov httpx
       29 +          uv pip install --system .[test,dev]
       30    
       31 +      - name: Install Playwright browsers
       32 +        run: |
       33 +          playwright install --with-deps chromium


# ai

## ì‘ì—… ë‚´ìš©

### ë¬¸ì œ ë°œìƒ: GitHub Actions CIê°€ 1-a ë‹¨ê³„ì—ì„œ ì‹¤í–‰ ì•ˆ ë¨

**ë°°ê²½**:
- Outside-in TDD ê°œë°œ ë°©ë²•ë¡ ì—ì„œ ì›Œí‚¹ ìŠ¤ì¼ˆë ˆí†¤(1-b ë‹¨ê³„) ì´í›„ CI/CDê°€ ê³„ì† ëŒì•„ì•¼ í•˜ëŠ”ì§€ ì§ˆë¬¸
- 1-b ë‹¨ê³„ì—ì„œëŠ” CIê°€ ì •ìƒ ë™ì‘í–ˆìœ¼ë‚˜, 1-a ë‹¨ê³„ ê°œë°œ ì¤‘ì—ëŠ” í•œ ë²ˆë„ ì‹¤í–‰ ì•ˆ ë¨

**ì¦ìƒ**:
```bash
$ git log --oneline -5
e07c9c6 ğŸ“ docs: ì£¼ë¬¸ ì·¨ì†Œ/í™˜ë¶ˆ ì •ì±… ëª…í™•í™”...
148c6d6 ğŸš© feat: ì¬ê³  ì°¨ê° ê¸°ëŠ¥ ë° Acceptance Test ì™„ì„± (1-a ë‹¨ê³„ ì™„ë£Œ)
b6300f8 ğŸ”§ fix: PayPal í™˜ê²½ë³€ìˆ˜ ë¡œë“œ...
a0da799 ğŸš© feat: PayPal SDK í†µí•©... (1-a ë‹¨ê³„)
0339a6a ğŸš© feat: ì£¼ë¬¸ ìƒì„± API êµ¬í˜„ (1-a ë‹¨ê³„)

$ git log origin/scouting/v1 --oneline -3
80b60e9 fix: health_check í•¨ìˆ˜ì— ë°˜í™˜ íƒ€ì… annotation ì¶”ê°€  # â† 1-b ë‹¨ê³„
25bce55 chore: í…ŒìŠ¤íŠ¸ìš© ë‚˜ìœ ì½”ë“œ íŒŒì¼ ì‚­ì œ
bb0817c fix: E2E conftestì—ì„œ Playwright import ì œê±°
```

**ì›ì¸ ì§„ë‹¨**:
- ë¡œì»¬ì—ëŠ” 1-a ë‹¨ê³„ ì»¤ë°‹ 7ê°œ ì¡´ì¬
- ì›ê²©(GitHub)ì—ëŠ” 1-b ë‹¨ê³„ê¹Œì§€ë§Œ ì¡´ì¬
- **ì»¤ë°‹ë§Œ í•˜ê³  pushë¥¼ ì•ˆ í•´ì„œ** GitHub Actionsê°€ íŠ¸ë¦¬ê±° ì•ˆ ë¨

**í•´ê²°**:
```bash
git push origin scouting/v1
```

---

### í•´ê²° 1: CI ì˜ì¡´ì„± ì„¤ì¹˜ ì˜¤ë¥˜ ìˆ˜ì •

**ë¬¸ì œ**: Push í›„ CI ì‹¤í–‰í–ˆìœ¼ë‚˜ í…ŒìŠ¤íŠ¸ ìˆ˜ì§‘ ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨

**ì˜¤ë¥˜ ë¡œê·¸**:
```
ERROR tests/e2e - ModuleNotFoundError: No module named 'playwright'
ERROR tests/integration/test_paypal_adapter.py
  ModuleNotFoundError: No module named 'paypalserversdk'
ERROR tests/e2e/test_order_query.py
  ImportError: email-validator is not installed
```

**ì›ì¸ ë¶„ì„** (`.github/workflows/ci.yml:28-30`):
```yaml
# Before (ì˜ëª»ëœ ë°©ì‹)
- name: Install dependencies
  run: |
    uv pip install --system -r pyproject.toml  # â† pyproject.tomlì€ requirements.txtê°€ ì•„ë‹˜
    uv pip install --system pytest pytest-cov httpx  # â† ìˆ˜ë™ìœ¼ë¡œ ì¼ë¶€ë§Œ ì„¤ì¹˜
```

**ìˆ˜ì • 1-1**: `pyproject.toml:9` - ëˆ„ë½ëœ ì˜ì¡´ì„± ì¶”ê°€
```toml
# Before
dependencies = [
    "fastapi>=0.104.0",
    "uvicorn[standard]>=0.24.0",
    "pydantic>=2.5.0",
]

# After
dependencies = [
    "fastapi>=0.104.0",
    "uvicorn[standard]>=0.24.0",
    "pydantic[email]>=2.5.0",  # â† [email] extraë¡œ email-validator í¬í•¨
    "paypal-server-sdk>=1.1.0",  # â† PayPal SDK ì¶”ê°€
    "python-dotenv>=1.0.0",  # â† í™˜ê²½ë³€ìˆ˜ ë¡œë“œìš©
]
```

**ìˆ˜ì • 1-2**: `.github/workflows/ci.yml:27-33` - ì˜¬ë°”ë¥¸ ì„¤ì¹˜ ëª…ë ¹ì–´
```yaml
# After
- name: Install dependencies
  run: |
    uv pip install --system .[test,dev]  # â† pyproject.tomlì˜ optional-dependencies í™œìš©

- name: Install Playwright browsers
  run: |
    playwright install --with-deps chromium  # â† Playwrightìš© ë¸Œë¼ìš°ì € ë³„ë„ ì„¤ì¹˜
```

**ì´ì **:
- pyproject.tomlì— ì •ì˜ëœ ëª¨ë“  ì˜ì¡´ì„± ìë™ ì„¤ì¹˜ (ëˆ„ë½ ë°©ì§€)
- `[test]`, `[dev]` ê·¸ë£¹ì˜ optional-dependenciesë„ í¬í•¨
- Playwright ë¸Œë¼ìš°ì € ìë™ ì„¤ì¹˜ë¡œ E2E í…ŒìŠ¤íŠ¸ ì¤€ë¹„

---

### í•´ê²° 2: GitHub Secrets ì„¤ì •

**ë¬¸ì œ**: ì˜ì¡´ì„± ì„¤ì¹˜ í›„ì—ë„ PayPal Integration í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨

**ì˜¤ë¥˜ ë¡œê·¸**:
```
ERROR tests/integration/test_paypal_adapter.py::test_paypal_adapter_create_order
  backend.services.payment.payment_service.PaymentServiceError:
  PayPal credentials not configured
```

**ì›ì¸**: CI í™˜ê²½ì— PayPal í™˜ê²½ë³€ìˆ˜ ì—†ìŒ
- ë¡œì»¬ ê°œë°œ: `.env` íŒŒì¼ë¡œ í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
- GitHub Actions: í™˜ê²½ë³€ìˆ˜ ì—†ìŒ â†’ PayPalAdapter ì´ˆê¸°í™” ì‹¤íŒ¨

**í•´ê²° ë°©ë²•**: GitHub CLIë¡œ Repository Secrets ë“±ë¡

1. **gh CLI ì„¤ì¹˜**:
```bash
# /tmp/install-gh.sh ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë° ì‹¤í–‰
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
# ... (ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸)
```

2. **GitHub ì¸ì¦**:
```bash
gh auth login  # ë¸Œë¼ìš°ì €ì—ì„œ ì¸ì¦ ì½”ë“œ ì…ë ¥
```

3. **Secrets ë“±ë¡** (`.env` íŒŒì¼ ê°’ ì‚¬ìš©):
```bash
echo "Ad4mhUZDXF4w_1ouz7c3u6cBcwUQVOLi89VnrFcJuNrCCCJA916yxIE-CvJy_gD-wpnaSbqXur90k4JC" \
  | gh secret set PAYPAL_CLIENT_ID

echo "EMIZLWUe5GHZW67Ta_wcKjnpcdIPdpEtNT1AFtveM65kAvCDbavGAacppeFGMBSBN3o0UxTtkyS5bFX1" \
  | gh secret set PAYPAL_CLIENT_SECRET

echo "https://api-m.sandbox.paypal.com" \
  | gh secret set PAYPAL_API_BASE
```

4. **ê²€ì¦**:
```bash
$ gh secret list
PAYPAL_API_BASE       2025-11-08T07:26:10Z
PAYPAL_CLIENT_ID      2025-11-08T07:25:50Z
PAYPAL_CLIENT_SECRET  2025-11-08T07:26:06Z
```

5. **CI ì›Œí¬í”Œë¡œìš°ì— í™˜ê²½ë³€ìˆ˜ ì¶”ê°€** (`.github/workflows/ci.yml:54-59`):
```yaml
- name: Run tests
  env:
    PAYPAL_CLIENT_ID: ${{ secrets.PAYPAL_CLIENT_ID }}
    PAYPAL_CLIENT_SECRET: ${{ secrets.PAYPAL_CLIENT_SECRET }}
    PAYPAL_API_BASE: ${{ secrets.PAYPAL_API_BASE }}
  run: |
    pytest tests/ -v --tb=short --no-cov
```

---

### í•´ê²° 3: E2E ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í†µí•©

**ë¬¸ì œ**: Playwright ê¸°ë°˜ E2E í…ŒìŠ¤íŠ¸ê°€ ì„œë²„ ì—°ê²° ì‹¤íŒ¨

**ì˜¤ë¥˜ ë¡œê·¸**:
```
FAILED tests/e2e/test_order_creation_flow.py::test_customer_can_create_order_and_pay_with_paypal
  playwright._impl._errors.Error: Page.goto: net::ERR_CONNECTION_REFUSED
  at http://localhost:8000/
```

**ì›ì¸**:
- PlaywrightëŠ” ì‹¤ì œ ë¸Œë¼ìš°ì €ë¡œ `http://localhost:8000` ì ‘ì† ì‹œë„
- CI í™˜ê²½ì—ì„œ ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

**ì´ì „ ì„ì‹œ í•´ê²°ì±…** (`.github/workflows/ci.yml:37`):
```yaml
# Before - E2E ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ì œì™¸
pytest tests/ -v --tb=short --no-cov --ignore=tests/e2e/test_order_creation_flow.py
```

**ê·¼ë³¸ í•´ê²°**: CIì—ì„œ ë°±ì—”ë“œ ì„œë²„ ìë™ ì‹œì‘ (`.github/workflows/ci.yml:35-68`):

```yaml
# After
- name: Start backend server
  env:
    PAYPAL_CLIENT_ID: ${{ secrets.PAYPAL_CLIENT_ID }}
    PAYPAL_CLIENT_SECRET: ${{ secrets.PAYPAL_CLIENT_SECRET }}
    PAYPAL_API_BASE: ${{ secrets.PAYPAL_API_BASE }}
  run: |
    # ë°±ê·¸ë¼ìš´ë“œë¡œ ì„œë²„ ì‹œì‘ (& ì‚¬ìš©)
    uvicorn backend.main:app --host 0.0.0.0 --port 8000 &
    echo $! > server.pid  # í”„ë¡œì„¸ìŠ¤ ID ì €ì¥ (ë‚˜ì¤‘ì— ì¢…ë£Œìš©)

    # ì„œë²„ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸° (ìµœëŒ€ 30ì´ˆ)
    for i in {1..30}; do
      if curl -s http://localhost:8000/health > /dev/null; then
        echo "âœ… Server is ready!"
        break
      fi
      echo "â³ Waiting for server... ($i/30)"
      sleep 1
    done

- name: Run tests
  env:
    PAYPAL_CLIENT_ID: ${{ secrets.PAYPAL_CLIENT_ID }}
    PAYPAL_CLIENT_SECRET: ${{ secrets.PAYPAL_CLIENT_SECRET }}
    PAYPAL_API_BASE: ${{ secrets.PAYPAL_API_BASE }}
  run: |
    pytest tests/ -v --tb=short --no-cov  # â† --ignore ì œê±° (ëª¨ë“  E2E í…ŒìŠ¤íŠ¸ í¬í•¨)

- name: Stop backend server
  if: always()  # í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨í•´ë„ í•­ìƒ ì‹¤í–‰
  run: |
    if [ -f server.pid ]; then
      kill $(cat server.pid) || true  # ì„œë²„ ì¢…ë£Œ
      rm server.pid
    fi
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `/health` ì—”ë“œí¬ì¸íŠ¸(`backend/main.py:31`)ë¡œ ì„œë²„ ì¤€ë¹„ ìƒíƒœ í™•ì¸
- `if: always()` ì¡°ê±´ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œì—ë„ ì„œë²„ ì •ë¦¬ ë³´ì¥
- ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰(`&`)ê³¼ PID ì €ì¥ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬

**ê²°ê³¼**:
- âœ… `test_customer_can_create_order_and_pay_with_paypal` í†µê³¼
- âœ… `test_customer_sees_product_information_on_landing_page` í†µê³¼
- âœ… `test_customer_cannot_order_more_than_available_stock` í†µê³¼

---

### í•´ê²° 4: Ruff ë¦°í„° ì˜¤ë¥˜ ìˆ˜ì •

**ë¬¸ì œ**: CIì˜ Linter ë‹¨ê³„ì—ì„œ 10ê°œ ì˜¤ë¥˜ ë°œìƒ

**ì˜¤ë¥˜ ë¡œê·¸**:
```
I001 Import block is un-sorted or un-formatted (4ê±´)
E501 Line too long (2ê±´)
E402 Module level import not at top of file (4ê±´)
```

**ìˆ˜ì • 4-1**: Import ì •ë ¬ (ìë™ ìˆ˜ì •)
```bash
uv run ruff check backend/ --fix
# 4ê±´ì˜ I001 ì˜¤ë¥˜ ìë™ í•´ê²°
```

**ìˆ˜ì • 4-2**: ê¸´ ë¼ì¸ ì¤„ë°”ê¿ˆ (`backend/api/orders.py:49, 77`)

```python
# Before (E501: Line too long 89 > 88)
@router.post("", response_model=OrderCreateResponse, status_code=status.HTTP_201_CREATED)

# After
@router.post(
    "", response_model=OrderCreateResponse, status_code=status.HTTP_201_CREATED
)
```

```python
# Before (E501: Line too long 102 > 88)
detail=f"Insufficient stock. Available: {product.stock}, Requested: {order_data.quantity}"

# After
detail=(
    f"Insufficient stock. Available: {product.stock}, "
    f"Requested: {order_data.quantity}"
),
```

**ìˆ˜ì • 4-3**: `load_dotenv()` í›„ import í—ˆìš© (`backend/main.py:9-13`)

```python
# Before (E402: Module level import not at top of file)
load_dotenv()

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
# ...

# After (noqa ì£¼ì„ìœ¼ë¡œ ì˜ë„ì  ìœ„ë°˜ ëª…ì‹œ)
load_dotenv()

from fastapi import FastAPI  # noqa: E402
from fastapi.middleware.cors import CORSMiddleware  # noqa: E402
from fastapi.staticfiles import StaticFiles  # noqa: E402

from backend.api.orders import router as orders_router  # noqa: E402
```

**E402ê°€ ë°œìƒí•˜ëŠ” ì´ìœ **:
- `backend/main.py:6`ì—ì„œ `load_dotenv()` ì‹¤í–‰ í•„ìš”
- `backend/api/orders.py:14`ì—ì„œ `PayPalAdapter()` ì´ˆê¸°í™” ì‹œ í™˜ê²½ë³€ìˆ˜ í•„ìš”
- ë”°ë¼ì„œ ëª¨ë“  importë³´ë‹¤ ë¨¼ì € `load_dotenv()` í˜¸ì¶œí•´ì•¼ í•¨
- `noqa: E402`ë¡œ ì´ ì˜ë„ë¥¼ ëª…ì‹œ

**ê²€ì¦**:
```bash
$ uv run ruff check backend/
All checks passed!
```

---

## ì´í•´ ìš”ì†Œ

### Outside-in TDDì—ì„œ CI/CDì˜ ì—­í• 

**í•µì‹¬ ê°œë…**: ì›Œí‚¹ ìŠ¤ì¼ˆë ˆí†¤ êµ¬ì¶• í›„ CI/CDëŠ” ê³„ì† ì‘ë™í•´ì•¼ í•¨

`docs/outside-in-tdd-guide.md:36-44`ì—ì„œ ì •ì˜:
> "ìë™ìœ¼ë¡œ ë¹Œë“œ, ë°°í¬, end-to-end í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ê°€ì¥ ì–‡ì€ ì‹¤ì œ ê¸°ëŠ¥ ì¡°ê°"
> "ë¹Œë“œ â†’ ë°°í¬ â†’ í…ŒìŠ¤íŠ¸ **ì „ì²´ í”„ë¡œì„¸ìŠ¤ ìë™í™”**"

**CI/CD vs ì‹¤ì œ ë°°í¬ êµ¬ë¶„**:

1. **CI/CD íŒŒì´í”„ë¼ì¸** (ì›Œí‚¹ ìŠ¤ì¼ˆë ˆí†¤ ì´í›„ ê³„ì† ì‚¬ìš©):
   - ëª¨ë“  ì»¤ë°‹/PRë§ˆë‹¤ í…ŒìŠ¤íŠ¸ ìë™ ì‹¤í–‰
   - 1-a, 2ë‹¨ê³„, 3ë‹¨ê³„ ëª¨ë‘ì—ì„œ ê³„ì† ì‹¤í–‰
   - **íšŒê·€ í…ŒìŠ¤íŠ¸ ë³´ì¥** (1-bì˜ ê¸°ëŠ¥ì´ 1-aì—ì„œ ì•ˆ ê¹¨ì§€ëŠ”ì§€ í™•ì¸)
   - ì˜ˆ: GitHub Actions CI

2. **ì‹¤ì œ ìš´ì˜ ë°°í¬** (MVP ì™„ì„± í›„):
   - Cloud Run, Firebase Hosting ë“±
   - ê°œë°œ/ìŠ¤í…Œì´ì§•/ìš´ì˜ í™˜ê²½ ë¶„ë¦¬
   - MVP ì™„ì„± ì „ì—ëŠ” ì„ íƒì 

**í˜„ì¬ í”„ë¡œì íŠ¸ ìƒíƒœ**:
- âœ… CI íŒŒì´í”„ë¼ì¸: ë§¤ pushë§ˆë‹¤ ìë™ ì‹¤í–‰
- â³ ìš´ì˜ ë°°í¬: ì•„ì§ ì•ˆ í•¨ (MVP ê°œë°œ ì¤‘)

---

### Repository Secrets vs Environment Secrets

**ì§ˆë¬¸**: "GitHub Secretsë¥¼ PayPal/SMTP ë“± ì„œë¹„ìŠ¤ë³„ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬í• ê¹Œ?"

**Repository Secrets** (`Settings â†’ Secrets and variables â†’ Actions`):
- íŠ¹ì§•:
  - ëª¨ë“  ë¸Œëœì¹˜, ëª¨ë“  ì›Œí¬í”Œë¡œìš°ì—ì„œ ì‚¬ìš© ê°€ëŠ¥
  - ì„¤ì • ê°„ë‹¨ - ë°”ë¡œ ì‚¬ìš©
  - í™˜ê²½ë³„ êµ¬ë¶„ ì—†ìŒ (dev/staging/prod ë™ì¼)
- ì‚¬ìš© ì˜ˆì‹œ:
  ```yaml
  env:
    PAYPAL_CLIENT_ID: ${{ secrets.PAYPAL_CLIENT_ID }}
  ```
- **í˜„ì¬ í”„ë¡œì íŠ¸ ì„ íƒ**: Repository Secrets ì‚¬ìš©
  - ì´ìœ : ëª¨ë“  ë¸Œëœì¹˜ì—ì„œ ë™ì¼í•œ Sandbox ìê²©ì¦ëª… ì‚¬ìš©
  - CI í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì¶©ë¶„

**Environment Secrets** (`Settings â†’ Environments â†’ (í™˜ê²½ ìƒì„±)`):
- íŠ¹ì§•:
  - í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ê°’ ì„¤ì • ê°€ëŠ¥ (development/staging/production)
  - ë°°í¬ ë³´í˜¸ ê·œì¹™ ì„¤ì • ê°€ëŠ¥ (ìŠ¹ì¸ í•„ìš”, íŠ¹ì • ë¸Œëœì¹˜ë§Œ í—ˆìš©)
  - ì›Œí¬í”Œë¡œìš°ì—ì„œ environment ëª…ì‹œ í•„ìš”
- ì‚¬ìš© ì˜ˆì‹œ:
  ```yaml
  jobs:
    deploy:
      environment: production  # â† í™˜ê²½ ì§€ì •
      steps:
        - env:
            API_KEY: ${{ secrets.API_KEY }}  # productionì˜ API_KEY ì‚¬ìš©
  ```
- **ë‚˜ì¤‘ì— ì‚¬ìš©**: ì‹¤ì œ ë°°í¬ ì‹œ
  - staging: Sandbox API
  - production: ì‹¤ì œ PayPal API

**ê°œë³„ Secret ê´€ë¦¬ ì „ëµ**:

ê¶Œì¥ ë°©ì‹ (í˜„ì¬ í”„ë¡œì íŠ¸):
```
PAYPAL_CLIENT_ID
PAYPAL_CLIENT_SECRET
PAYPAL_API_BASE
GMAIL_ADDRESS (ë‚˜ì¤‘ì— ì¶”ê°€)
GMAIL_APP_PASSWORD (ë‚˜ì¤‘ì— ì¶”ê°€)
```

ì´ì :
- ëª…í™•ì„±: ì–´ë–¤ ê°’ì¸ì§€ ë°”ë¡œ ì•Œ ìˆ˜ ìˆìŒ
- ì¬ì‚¬ìš©ì„±: ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ì—ì„œë„ ê°œë³„ì ìœ¼ë¡œ ì‚¬ìš©
- ë³´ì•ˆ: í•„ìš”í•œ ê²ƒë§Œ ë…¸ì¶œ
- ê´€ë¦¬ í¸í•¨: í•˜ë‚˜ë§Œ ë°”ê¾¸ë©´ ë¨

ë¹„ê¶Œì¥ ë°©ì‹ (JSON ê·¸ë£¹í™”):
```yaml
PAYPAL_SECRETS: '{"client_id": "...", "secret": "..."}'  # â† ë³µì¡í•¨
```

---

### E2E í…ŒìŠ¤íŠ¸ ì¢…ë¥˜ì™€ ì„œë²„ ìš”êµ¬ì‚¬í•­

**í”„ë¡œì íŠ¸ì— ì¡´ì¬í•˜ëŠ” ë‘ ì¢…ë¥˜ì˜ E2E í…ŒìŠ¤íŠ¸**:

1. **TestClient ê¸°ë°˜** (`tests/e2e/test_order_query.py`):
```python
from fastapi.testclient import TestClient

def test_query_order_returns_order_details(test_client: TestClient):
    response = test_client.get(f"/api/orders/{order_number}")
```

íŠ¹ì§•:
- FastAPI ë‚´ë¶€ì ìœ¼ë¡œ ì•± í˜¸ì¶œ (HTTP ì—†ì´)
- **ì‹¤ì œ ì„œë²„ ë¶ˆí•„ìš”**
- ë¹ ë¥´ê³  ê°€ë²¼ì›€
- API ë ˆë²¨ í…ŒìŠ¤íŠ¸ì— ì í•©

2. **Playwright ê¸°ë°˜** (`tests/e2e/test_order_creation_flow.py`):
```python
from playwright.sync_api import Page

def test_customer_can_create_order_and_pay_with_paypal(page: Page):
    page.goto("http://localhost:8000")  # â† ì‹¤ì œ HTTP ìš”ì²­
    page.fill("#customer_name", "Maria Santos")
    page.click("#order_button")
```

íŠ¹ì§•:
- ì‹¤ì œ ë¸Œë¼ìš°ì €(Chromium) ì‹¤í–‰
- **ì‹¤ì œ ì„œë²„ í•„ìš”** (localhost:8000)
- ì‚¬ìš©ì ê´€ì ì˜ ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- UI ë ˆë²¨ í…ŒìŠ¤íŠ¸ì— ì í•©

**Outside-in TDD ê°€ì´ë“œ ì›ì¹™** (`docs/outside-in-tdd-guide.md:24-30`):
> "ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ìš”ì†Œ"
> - âœ… ì™¸ë¶€ì—ì„œë§Œ ì‹œìŠ¤í…œê³¼ ìƒí˜¸ì‘ìš© (UI í†µí•´ì„œë§Œ)
> - âœ… ë¹Œë“œ â†’ ë°°í¬ â†’ í…ŒìŠ¤íŠ¸ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ìë™í™”
> - âœ… í”„ë¡œë•ì…˜ê³¼ ìœ ì‚¬í•œ í™˜ê²½ì—ì„œ ì‹¤í–‰

**"í”„ë¡œë•ì…˜ê³¼ ìœ ì‚¬í•œ í™˜ê²½"ì˜ ì˜ë¯¸**:
- âŒ Cloud Runì— ì‹¤ì œ ë°°í¬ (ë¶ˆí•„ìš”)
- âœ… ë¡œì»¬ì—ì„œ ì‹¤ì œ ë°±ì—”ë“œ ì„œë²„ + ì‹¤ì œ ë¸Œë¼ìš°ì €
- âœ… í…ŒìŠ¤íŠ¸ DB ì‚¬ìš©
- âœ… PayPal Sandbox API ì—°ë™

---

## íŒë‹¨ ìš”ì†Œ

### CI ì˜ì¡´ì„± ì„¤ì¹˜ ë°©ë²• ì„ íƒ

**ì„ íƒì§€**:

A. ìˆ˜ë™ ë‚˜ì—´:
```yaml
- run: |
    uv pip install --system fastapi uvicorn pydantic
    uv pip install --system pytest pytest-cov httpx
    uv pip install --system playwright paypal-server-sdk
    # ... ê³„ì† ì¶”ê°€
```

B. pyproject.toml optional-dependencies í™œìš©:
```yaml
- run: uv pip install --system .[test,dev]
```

**ì„ íƒ**: B ë°©ì‹ (`.[test,dev]`)

**ì´ìœ ** (í˜„ì¬ ìƒí™© ë§¥ë½):
1. **ëˆ„ë½ ë°©ì§€**:
   - 1-a ë‹¨ê³„ì—ì„œ PayPal SDK ì¶”ê°€í–ˆëŠ”ë° CI ìŠ¤í¬ë¦½íŠ¸ì— ì¶”ê°€ ì•ˆ í•¨
   - pyproject.tomlì—ë§Œ ì¶”ê°€í•˜ë©´ ìë™ ë°˜ì˜
2. **ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›**:
   - ì˜ì¡´ì„± ì •ì˜ê°€ pyproject.toml í•œ ê³³ì—ë§Œ ì¡´ì¬
   - CIì™€ ë¡œì»¬ ê°œë°œ í™˜ê²½ ì¼ì¹˜ ë³´ì¥
3. **ê·¸ë£¹ ê´€ë¦¬**:
   - `[test]`: pytest, playwright ë“±
   - `[dev]`: ruff, mypy ë“±
   - í•„ìš”í•œ ê·¸ë£¹ë§Œ ì„ íƒ ì„¤ì¹˜ ê°€ëŠ¥

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- ì¥ì : ìë™í™”, ì¼ê´€ì„±, ìœ ì§€ë³´ìˆ˜ì„±
- ë‹¨ì : pyproject.toml êµ¬ì¡° ì´í•´ í•„ìš”

---

### GitHub Secrets ê°œë³„ ê´€ë¦¬ ì „ëµ

**ì„ íƒì§€**:

A. ì„œë¹„ìŠ¤ë³„ JSON ë¬¶ê¸°:
```yaml
env:
  PAYPAL_SECRETS: ${{ secrets.PAYPAL_SECRETS }}  # '{"client_id": "...", "secret": "..."}'
```

B. í™˜ê²½ë³€ìˆ˜ë³„ ê°œë³„ Secret:
```yaml
env:
  PAYPAL_CLIENT_ID: ${{ secrets.PAYPAL_CLIENT_ID }}
  PAYPAL_CLIENT_SECRET: ${{ secrets.PAYPAL_CLIENT_SECRET }}
```

**ì„ íƒ**: B ë°©ì‹ (ê°œë³„ Secret)

**ì´ìœ ** (í˜„ì¬ ìƒí™© ë§¥ë½):
1. **ëª…í™•ì„±**:
   - Secret ì´ë¦„ë§Œ ë´ë„ ìš©ë„ íŒŒì•… ê°€ëŠ¥
   - `PAYPAL_CLIENT_ID` vs `PAYPAL_SECRETS.client_id`
2. **ì¬ì‚¬ìš©ì„±**:
   - ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ì—ì„œ ì¼ë¶€ë§Œ ì‚¬ìš© ê°€ëŠ¥
   - ì˜ˆ: CD íŒŒì´í”„ë¼ì¸ì—ì„œëŠ” `PAYPAL_API_BASE`ë§Œ ë³€ê²½
3. **ë³´ì•ˆ**:
   - í•„ìš”í•œ Secretë§Œ ì›Œí¬í”Œë¡œìš°ì— ë…¸ì¶œ
   - JSON ë°©ì‹ì€ ì „ì²´ ë¬¶ìŒ ë…¸ì¶œ í•„ìš”
4. **ê´€ë¦¬ í¸ì˜ì„±**:
   - Client IDë§Œ ë³€ê²½ ì‹œ í•´ë‹¹ Secretë§Œ ì—…ë°ì´íŠ¸
   - JSONì€ ì „ì²´ ì¬ìƒì„± í•„ìš”

**ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€** (í˜„ì¬ í”„ë¡œì íŠ¸):
```bash
# ê°œë³„ Secret ë“±ë¡ (3ê°œ ëª…ë ¹)
echo "..." | gh secret set PAYPAL_CLIENT_ID
echo "..." | gh secret set PAYPAL_CLIENT_SECRET
echo "..." | gh secret set PAYPAL_API_BASE

# JSON ë°©ì‹ì´ë¼ë©´ (1ê°œ ëª…ë ¹ì´ì§€ë§Œ ë³µì¡)
echo '{"client_id":"...","secret":"...","base":"..."}' | gh secret set PAYPAL_SECRETS
```

---

### E2E ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í¬í•¨ ë°©ë²•

**ì„ íƒì§€**:

A. E2E ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ ì œì™¸:
```yaml
pytest tests/ --ignore=tests/e2e/test_order_creation_flow.py
```

B. Docker Composeë¡œ ì„œë¹„ìŠ¤ êµ¬ì„±:
```yaml
services:
  backend:
    build: .
    ports:
      - "8000:8000"
  tests:
    depends_on:
      - backend
```

C. CI ìŠ¤í…ì—ì„œ ì„œë²„ ì§ì ‘ ì‹œì‘/ì¢…ë£Œ:
```yaml
- name: Start backend server
  run: uvicorn backend.main:app &
- name: Run tests
  run: pytest tests/
- name: Stop backend server
  run: kill $SERVER_PID
```

**ì„ íƒ**: C ë°©ì‹ (CI ìŠ¤í…ì—ì„œ ì§ì ‘ ê´€ë¦¬)

**ì´ìœ ** (í˜„ì¬ ìƒí™© ë§¥ë½):
1. **ë‹¨ìˆœì„±**:
   - Docker Compose ì„¤ì • íŒŒì¼ ë¶ˆí•„ìš”
   - GitHub Actions ì›Œí¬í”Œë¡œìš°ì—ì„œ ëª¨ë“  ê²ƒ íŒŒì•… ê°€ëŠ¥
2. **ëª…ì‹œì„±**:
   - ì„œë²„ ì‹œì‘ â†’ í…ŒìŠ¤íŠ¸ â†’ ì„œë²„ ì¢…ë£Œ ìˆœì„œ ëª…í™•
   - ë¡œê·¸ì—ì„œ ê° ë‹¨ê³„ ì¶”ì  ê°€ëŠ¥
3. **ë””ë²„ê¹… ìš©ì´**:
   - ì„œë²„ ì¤€ë¹„ ìƒíƒœ í™•ì¸ ë¡œì§ í¬í•¨ (`/health` ì²´í¬)
   - ì‹¤íŒ¨ ì‹œ ì–´ëŠ ë‹¨ê³„ì—ì„œ ë¬¸ì œì¸ì§€ íŒŒì•… ì‰¬ì›€
4. **í˜„ì¬ í”„ë¡œì íŠ¸ ê·œëª¨**:
   - ë‹¨ì¼ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë§Œ í•„ìš”
   - DBëŠ” Mock ë°ì´í„° ì‚¬ìš© (ì‹¤ì œ PostgreSQL ë¶ˆí•„ìš”)
   - Docker Composeì˜ ë³µì¡ì„± ë¶ˆí•„ìš”

**êµ¬í˜„ ì„¸ë¶€ì‚¬í•­**:
```yaml
# ì„œë²„ ì¤€ë¹„ ëŒ€ê¸° ë¡œì§ (ìµœëŒ€ 30ì´ˆ)
for i in {1..30}; do
  if curl -s http://localhost:8000/health > /dev/null; then
    echo "âœ… Server is ready!"
    break
  fi
  sleep 1
done
```

**íŠ¸ë ˆì´ë“œì˜¤í”„**:
- ì¥ì : ë‹¨ìˆœ, ëª…í™•, ë””ë²„ê¹… ì‰¬ì›€
- ë‹¨ì : ë³µì¡í•œ ë‹¤ì¤‘ ì„œë¹„ìŠ¤ í™˜ê²½ì—ëŠ” ë¶€ì í•© (í˜„ì¬ëŠ” í•´ë‹¹ ì—†ìŒ)

---

## ê°œì„  ìš”ì†Œ

### [í…ŒìŠ¤íŠ¸ ì°¨ì›] E2E í…ŒìŠ¤íŠ¸ ì„œë²„ ê´€ë¦¬

**í˜„ì¬ í•œê³„**: CI ì›Œí¬í”Œë¡œìš°ì—ì„œ ì„œë²„ ì‹œì‘/ì¢…ë£Œ ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ê´€ë¦¬

ë¬¸ì œì :
- ì„œë²„ ìƒëª…ì£¼ê¸° ê´€ë¦¬ ë¡œì§ì´ `.github/workflows/ci.yml`ì— í•˜ë“œì½”ë”©
- ë¡œì»¬ì—ì„œ E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ ìˆ˜ë™ìœ¼ë¡œ ì„œë²„ ì‹œì‘ í•„ìš”
- í…ŒìŠ¤íŠ¸ì™€ ì¸í”„ë¼ ì„¤ì •ì´ ë¶„ë¦¬ë˜ì–´ ìˆìŒ

**ê°œì„  ë°©í–¥**: pytest fixtureë¡œ ì„œë²„ ìƒëª…ì£¼ê¸° ê´€ë¦¬

```python
# tests/conftest.py
import subprocess
import time
import pytest
import requests

@pytest.fixture(scope="session")
def backend_server():
    """ë°±ì—”ë“œ ì„œë²„ ìë™ ì‹œì‘/ì¢…ë£Œ fixture"""
    # ì„œë²„ ì‹œì‘
    process = subprocess.Popen(
        ["uvicorn", "backend.main:app", "--host", "0.0.0.0", "--port", "8000"],
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
    )

    # ì„œë²„ ì¤€ë¹„ ëŒ€ê¸°
    for _ in range(30):
        try:
            response = requests.get("http://localhost:8000/health")
            if response.status_code == 200:
                break
        except requests.ConnectionError:
            time.sleep(1)
    else:
        process.kill()
        raise RuntimeError("Server failed to start")

    yield "http://localhost:8000"

    # ì„œë²„ ì¢…ë£Œ
    process.terminate()
    process.wait(timeout=5)
```

```python
# tests/e2e/test_order_creation_flow.py
@pytest.mark.e2e
def test_customer_can_create_order(page: Page, backend_server: str):
    """backend_server fixtureê°€ ìë™ìœ¼ë¡œ ì„œë²„ ì‹œì‘"""
    page.goto(backend_server)  # â† fixtureì—ì„œ ì œê³µí•˜ëŠ” URL ì‚¬ìš©
    # ...
```

```yaml
# .github/workflows/ci.yml (ê°„ì†Œí™”)
- name: Run tests
  env:
    # í™˜ê²½ë³€ìˆ˜ë§Œ ì„¤ì •
    PAYPAL_CLIENT_ID: ${{ secrets.PAYPAL_CLIENT_ID }}
    # ...
  run: |
    pytest tests/ -v  # â† ì„œë²„ ì‹œì‘/ì¢…ë£Œ ë¡œì§ ì œê±° (fixtureê°€ ì²˜ë¦¬)
```

ì´ì :
- ë¡œì»¬/CI í™˜ê²½ì—ì„œ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ëŠ¥
- í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì„œë²„ URLì„ fixtureë¡œ ì£¼ì…ë°›ì•„ ìœ ì—°ì„± ì¦ê°€
- CI ì›Œí¬í”Œë¡œìš° ë‹¨ìˆœí™” (í™˜ê²½ë³€ìˆ˜ ì„¤ì •ë§Œ í•„ìš”)
- pytestì˜ scope ê¸°ëŠ¥ìœ¼ë¡œ ì„œë²„ ì¬ì‹œì‘ ìµœì†Œí™” (session scope)

---

### [ì•„í‚¤í…ì²˜ ì°¨ì›] í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬

**í˜„ì¬ í•œê³„**: `.env` íŒŒì¼ê³¼ GitHub Secretsë¡œ í™˜ê²½ ê´€ë¦¬

ë¬¸ì œì :
- ë¡œì»¬ ê°œë°œ: `.env` íŒŒì¼
- CI í…ŒìŠ¤íŠ¸: GitHub Repository Secrets
- ë‚˜ì¤‘ì— ë°°í¬: í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ê°’ í•„ìš” (dev/staging/prod)
- í™˜ê²½ë³„ ì„¤ì • ì „ëµ ë¶€ì¬

**ê°œì„  ë°©í–¥**: í™˜ê²½ë³„ ì„¤ì • íŒŒì¼ + Pydantic Settings

```python
# backend/config.py
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    """í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬"""

    # PayPal
    paypal_client_id: str
    paypal_client_secret: str
    paypal_api_base: str = "https://api-m.sandbox.paypal.com"

    # Database
    database_url: str = "postgresql://localhost/scout"

    # Email
    smtp_server: str = "smtp.gmail.com"
    smtp_port: int = 587
    gmail_address: str | None = None
    gmail_app_password: str | None = None

    model_config = SettingsConfigDict(
        env_file=".env",  # ë¡œì»¬ ê°œë°œìš©
        env_file_encoding="utf-8",
        case_sensitive=False,
    )

# ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
settings = Settings()
```

```python
# backend/services/payment/paypal_adapter.py
from backend.config import settings  # â† os.getenv() ëŒ€ì‹  ì‚¬ìš©

class PayPalAdapter:
    def __init__(self):
        if not settings.paypal_client_id or not settings.paypal_client_secret:
            raise PaymentServiceError("PayPal credentials not configured")

        self.client = PaypalServersdkClient(
            client_credentials_auth_credentials=ClientCredentialsAuthCredentials(
                o_auth_client_id=settings.paypal_client_id,
                o_auth_client_secret=settings.paypal_client_secret,
            ),
            environment=Environment.SANDBOX,  # settings.paypal_envë¡œ ì œì–´ ê°€ëŠ¥
        )
```

```bash
# .env.development (ë¡œì»¬ ê°œë°œ)
PAYPAL_API_BASE=https://api-m.sandbox.paypal.com
DATABASE_URL=postgresql://localhost/scout_dev

# .env.staging (ìŠ¤í…Œì´ì§•)
PAYPAL_API_BASE=https://api-m.sandbox.paypal.com
DATABASE_URL=postgresql://cloud-sql/scout_staging

# .env.production (ìš´ì˜)
PAYPAL_API_BASE=https://api-m.paypal.com  # â† Production API
DATABASE_URL=postgresql://cloud-sql/scout_prod
```

ì´ì :
- íƒ€ì… ì•ˆì „ì„±: Pydanticì˜ ê²€ì¦ ê¸°ëŠ¥ í™œìš©
- í™˜ê²½ë³„ ê¸°ë³¸ê°’ ì„¤ì • ê°€ëŠ¥
- ì„¤ì • ëˆ„ë½ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
- í…ŒìŠ¤íŠ¸ì—ì„œ ì„¤ì • ì˜¤ë²„ë¼ì´ë“œ ìš©ì´
  ```python
  def test_with_custom_settings(monkeypatch):
      monkeypatch.setattr("backend.config.settings.paypal_api_base", "http://mock")
  ```
- ë¬¸ì„œí™”: ëª¨ë“  ì„¤ì •ì´ í•œ íŒŒì¼(`config.py`)ì— ëª…ì‹œ